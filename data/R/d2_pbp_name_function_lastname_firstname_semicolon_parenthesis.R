library(tidyverse)
library(rvest)
library(httr2)
library(xml2)

name_function_lastname_firstname_semicolon_parenthesis <- function(pbp) {
  ### function to get the names from NCAA D2 stats ORG play by play data with the names being lastname,firstname format and 
  ### parenthesis with ";" and the separator.
  
  pbp_with_names <- pbp %>% 
    mutate(completion_player_name = if_else(completion == 1 & str_detect(value, regex("complete",ignore_case = TRUE )),
                                           str_extract(value, ".+?(?=pass)"),
                                            NA_character_),
           completion_player_name = if_else(str_detect(completion_player_name,regex("No Huddle-Shotgun ",ignore_case = TRUE)),
                                       str_remove(completion_player_name,regex("No Huddle-Shotgun ",ignore_case = TRUE)),
                                       completion_player_name),
           completion_player_name = if_else(str_detect(completion_player_name,regex("Shotgun ",ignore_case = TRUE)),
                                       str_remove(completion_player_name,regex("Shotgun ",ignore_case = TRUE)),
                                       completion_player_name),
           completion_player_name = if_else(str_detect(completion_player_name,regex("No Huddle ",ignore_case = TRUE)),
                                            str_remove(completion_player_name,regex("No Huddle ",ignore_case = TRUE)),
                                            completion_player_name),
          # completion_player_name = if_else(str_detect(completion_player_name, "[, Jr]"),
           #                                 str_remove(completion_player_name, "[,]"),
            #                                completion_player_name),
           completion_player_name = if_else(str_detect(completion_player_name,"[,]"),
                                        str_replace(completion_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                        completion_player_name),
           completion_player_name = if_else(str_detect(completion_player_name, " \\s*\\([^\\)]+\\)"),
                                        str_remove(completion_player_name, " \\s*\\([^\\)]+\\)"),
                                        completion_player_name),
           completion_player_name = str_squish(completion_player_name),
           reception_player_name = if_else(completion == 1,
                                           sub(".* to *(.*?) *for.*", "\\1", value),
                                           NA_character_),
           reception_player_name = if_else(!is.na(reception_player_name),
                                           str_extract(reception_player_name, 
                                                       ".+?(?=caught)"),
                                           NA_character_),
           reception_player_name = if_else(str_detect(reception_player_name, ", Jr"),
                   str_remove(reception_player_name, ","),
                   reception_player_name),
           reception_player_name = if_else(str_detect(reception_player_name, ","),
                                           str_replace(reception_player_name,"(.*),\\s*(.*)", "\\2 \\1"),
                                           reception_player_name),
           reception_player_name = if_else(is.na(reception_player_name) & 
                                             str_detect(value,regex("pass complete", ignore_case = TRUE)),
                                           sub(".* to *(.*?) * for.*", "\\1", value),
                                           reception_player_name),
           reception_player_name = if_else(str_detect(reception_player_name, regex("caught at",ignore_case = TRUE)),
                                           str_remove(reception_player_name, regex("caught at.*")),
                                           reception_player_name),
           reception_player_name = str_trim(reception_player_name, side = "both"),
           reception_player_name = if_else(str_detect(reception_player_name, ","),
                                           str_replace(reception_player_name,"(.*),\\s*(.*)", "\\2 \\1"),
                                           reception_player_name),
           reception_player_name = str_squish(reception_player_name),
           reception_player_name = if_else(str_detect(reception_player_name, "Jr. "),
                                        str_c(word(reception_player_name, start = 2, end = 3), "Jr.", sep = " "),
                                        reception_player_name),
           passer_player_name = if_else(incompletion == 1 | interception == 1,
                                        str_extract(value, ".+?(?=pass)"),
                                        NA_character_),
           passer_player_name = if_else(sack == 1,
                                        str_extract(value, ".+?(?=sacked)"),
                                        passer_player_name),
           passer_player_name = if_else(str_detect(passer_player_name, regex("No Huddle-Shotgun",ignore_case = TRUE)),
                                        str_remove(passer_player_name,regex("No Huddle-Shotgun",ignore_case = TRUE)),
                                        passer_player_name),
           passer_player_name = if_else(str_detect(passer_player_name, regex("Shotgun",ignore_case = TRUE)),
                                        str_remove(passer_player_name,regex("Shotgun",ignore_case = TRUE)),
                                        passer_player_name),
           passer_player_name = if_else(str_detect(passer_player_name, regex("No Huddle",ignore_case = TRUE)),
                                        str_remove(passer_player_name,regex("No Huddle",ignore_case = TRUE)),
                                        passer_player_name),
           passer_player_name = if_else(str_detect(passer_player_name,","),
                                        str_replace(passer_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                        passer_player_name),
           passer_player_name = if_else(str_detect(passer_player_name, " \\s*\\([^\\)]+\\)"),
                                        str_remove(passer_player_name, " \\s*\\([^\\)]+\\)"),
                                        passer_player_name),
           passer_player_name = if_else(completion == 1,
                                        completion_player_name,
                                        passer_player_name),
           passer_player_name = str_squish(passer_player_name),
           targeted_player_name = if_else(completion == 1,reception_player_name,NA_character_),
           targeted_player_name = if_else(pass_attempt == 1 & incompletion == 1 & no_play == 0,
                                          gsub(".* to (.*?) thrown.*", "\\1", value),targeted_player_name),
           targeted_player_name = if_else(str_detect(value,regex("pass incomplete to", ignore_case = TRUE)),
                                          str_extract(value,"(?<=pass incomplete to ).*"),
                                          targeted_player_name),
           targeted_player_name = if_else(str_detect(targeted_player_name, " \\s*\\([^\\)]+\\)"),
                                          str_remove(targeted_player_name, " \\s*\\([^\\)]+\\)"),
                                          targeted_player_name),
           targeted_player_name = if_else(str_detect(targeted_player_name, "[.]"),
                                          str_remove(targeted_player_name, "[.]"),
                                                     targeted_player_name),
           targeted_player_name = if_else(str_detect(targeted_player_name, ", dropped pass"),
                                          str_remove(targeted_player_name, ", dropped pass"),
                                          targeted_player_name),
          targeted_player_name = if_else(str_detect(targeted_player_name, ", (?i)penalty"),
                                         str_remove(targeted_player_name, ", (?i)penalty.*"),
                                         targeted_player_name), 
           targeted_player_name = if_else(is.na(completion_player_name),
                                          str_replace(targeted_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                          targeted_player_name),
           targeted_player_name = if_else(str_detect(targeted_player_name,regex("pass incomplete")),
                                                     NA_character_,
                                                     targeted_player_name),
           targeted_player_name = str_squish(targeted_player_name),
           targeted_player_name = if_else(str_detect(targeted_player_name, "Jr") & is.na(reception_player_name),
                                        str_c(word(targeted_player_name, start = 2, end = 3), "Jr.", sep = " "),
                                        targeted_player_name),
          targeted_player_name = if_else(no_play == 1,
                                         NA_character_,
                                         targeted_player_name),
           sack_taken_player_name = if_else(sack == 1,passer_player_name,NA_character_),
           rusher_player_name = if_else(rush == 1,str_extract(value, ".+?(?=rush)"),NA_character_),
           rusher_player_name = if_else(rush == 1 & str_detect(rusher_player_name,regex("No Huddle-Shotgun",ignore_case = TRUE)),
                                        str_remove(rusher_player_name,regex("No Huddle-Shotgun",ignore_case = TRUE)),
                                        rusher_player_name),
           rusher_player_name = if_else(rush == 1 & str_detect(rusher_player_name,regex("Shotgun",ignore_case = TRUE)),
                                        str_remove(rusher_player_name,regex("Shotgun",ignore_case = TRUE)),
                                        rusher_player_name),
           rusher_player_name = if_else(rush == 1 & str_detect(rusher_player_name,regex("No Huddle",ignore_case = TRUE)),
                                        str_remove(rusher_player_name,regex("No Huddle",ignore_case = TRUE)),
                                        rusher_player_name),
           rusher_player_name = if_else(str_detect(rusher_player_name,","),
                                        str_replace(rusher_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                        rusher_player_name),
           rusher_player_name = if_else(str_detect(rusher_player_name, " \\s*\\([^\\)]+\\)"),
                                        str_remove(rusher_player_name, " \\s*\\([^\\)]+\\)"),
                                        rusher_player_name),
           rusher_player_name = str_squish(rusher_player_name),
           rusher_player_name = if_else(str_detect(rusher_player_name, "Jr. "),
                                        str_c(word(rusher_player_name, start = 2, end = 3), "Jr.", sep = " "),
                                        rusher_player_name),
           rusher_player_name = str_squish(rusher_player_name),
           punter_player_name = if_else(punt == 1,str_extract(value, ".+?(?=punt)"),NA_character_),
           punter_player_name = if_else(!is.na(punter_player_name),
                                        str_replace(punter_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                        punter_player_name),
           punter_player_name = if_else(str_detect(punter_player_name, " \\s*\\([^\\)]+\\)"),
                                        str_remove(punter_player_name, " \\s*\\([^\\)]+\\)"),
                                        punter_player_name),
           punter_player_name = str_squish(punter_player_name),
           punt_returner_player_name = if_else(punt == 1 & str_detect(value, regex("return",ignore_case = TRUE)),
                                             sub(".* [A-Z]+[0-9]+ *(.*?) *return .*", "\\1", value),
                                             NA_character_),
           punt_returner_player_name = if_else(punt_fair_catch == 1,
                                               sub(".* by *(.*?) * at .*", "\\1", value),
                                               punt_returner_player_name),
           punt_returner_player_name = if_else(!is.na(punt_returner_player_name),
                                               str_replace(punt_returner_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                               punt_returner_player_name),
       #    punt_returner_player_name = if_else(str_detect(value, "Bates") & punt_fair_catch == 1,
        #                                       str_c(punt_returner_player_name, "ates", sep = ""),
         #                                      punt_returner_player_name),
          # punt_returner_player_name = if_else(str_detect(value, "Batiste") & punt_fair_catch == 1,
           #                                    str_c(punt_returner_player_name, "atiste", sep = ""),
            #                                   punt_returner_player_name),
           punt_returner_player_name = if_else(str_count(punt_returner_player_name, '\\w+') > 6,
                                               str_extract(punt_returner_player_name, ".+?(?=return)"),
                                                           punt_returner_player_name),
           punt_returner_player_name = str_trim(punt_returner_player_name, side = "both"),
           punt_returner_player_name = if_else(str_count(punt_returner_player_name, '\\w+') > 6,
                                               gsub(".*\\s" , "",punt_returner_player_name),
                                               punt_returner_player_name),
           punt_returner_player_name = if_else(str_detect(punt_returner_player_name, "[,]"),
                                               str_replace(punt_returner_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                               punt_returner_player_name),
           punt_returner_player_name = str_squish(punt_returner_player_name),
           kickoff_player_name = if_else(kickoff_play == 1,str_extract(value, ".+?(?=kickoff)"),NA_character_),
           kickoff_player_name = if_else(str_detect(kickoff_player_name, regex("onside",ignore_case = TRUE)),
                                         str_remove(kickoff_player_name,regex("onside",ignore_case = TRUE)),
                                         kickoff_player_name),
           kickoff_player_name = if_else(!is.na(kickoff_player_name),
                                        str_replace(kickoff_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                        kickoff_player_name),
           kickoff_player_name = if_else(str_detect(kickoff_player_name, " \\s*\\([^\\)]+\\)"),
                                        str_remove(kickoff_player_name, " \\s*\\([^\\)]+\\)"),
                                        kickoff_player_name),
           kickoff_player_name = str_squish(kickoff_player_name),
           kickoff_returner_player_name = if_else(kickoff_play == 1 & str_detect(value,regex("return",ignore_case = TRUE)),
                                                  sub(".*[A-Z]+[0-9]+ *(.*?) * return.*", "\\1", value),
                                                  NA_character_),
      kickoff_returner_player_name = if_else(str_detect(kickoff_returner_player_name, ", "),
                                              str_remove(kickoff_returner_player_name, ", "),
                                              kickoff_returner_player_name),
           kickoff_returner_player_name = if_else(str_count(kickoff_returner_player_name, '\\w+') > 6,
                                               str_extract(kickoff_returner_player_name, ".+?(?=return)"),
                                               kickoff_returner_player_name),
           kickoff_returner_player_name = str_squish(kickoff_returner_player_name),
           kickoff_returner_player_name = if_else(str_count(kickoff_returner_player_name, '\\w+') > 6,
                                               gsub(".*\\s" , "",kickoff_returner_player_name),
                                               kickoff_returner_player_name),
           kickoff_returner_player_name = if_else(str_detect(kickoff_returner_player_name, ","),
                                               str_replace(kickoff_returner_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                               kickoff_returner_player_name),
           kickoff_returner_player_name = if_else(!is.na(kickoff_returner_player_name) & str_detect(kickoff_returner_player_name, ","),
                                               str_replace(kickoff_returner_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                               kickoff_returner_player_name),
           kickoff_returner_player_name = str_squish(kickoff_returner_player_name),
           field_goal_player_name = if_else(field_goal == 1,str_extract(value, ".+?(?=field)"),NA_character_),
           field_goal_player_name = if_else(!is.na(field_goal_player_name),
                                            str_replace(field_goal_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                            field_goal_player_name),
           field_goal_player_name = if_else(str_detect(field_goal_player_name, " \\s*\\([^\\)]+\\)"),
                                        str_remove(field_goal_player_name, " \\s*\\([^\\)]+\\)"),
                                        field_goal_player_name),
           field_goal_player_name = str_squish(field_goal_player_name),
           penalty_play_text = if_else(penalty == 1,str_extract(value, "(?=PENALTY).*"),NA_character_),
           extra_point_player_name = if_else(extra_point_attempt == 1,str_extract(value, ".+?(?=kick)"),NA_character_),
           extra_point_player_name = if_else(!is.na(extra_point_player_name),
                                             str_replace(extra_point_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                             extra_point_player_name),
           extra_point_player_name = str_squish(extra_point_player_name),
           sack_player_name = if_else(sack == 1,
                                      str_remove(value, "^\\S* "),
                                      NA_character_),
           sack_player_name = if_else(!is.na(sack_player_name),
                                      str_extract(sack_player_name, "(?<=\\().+?(?=\\))"),
                                      sack_player_name),
           sack_player_name = if_else(str_detect(sack_player_name, "3a"),
                                      str_replace(sack_player_name,"3a",","),
                                      sack_player_name),
           sack_player_name_2 = if_else(grepl("^([^,]*,){3}[^,]*$", sack_player_name),
                                        sub("^[^,]*,[^,]*,", "", sack_player_name),
                                        NA_character_),
           sack_player_name_2 = str_trim(sack_player_name_2, side = "both"),
           solo_sack_player_name = if_else(!is.na(sack_player_name) & is.na(sack_player_name_2),
                                                  str_replace(sack_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                                  NA_character_),
           half_sack_player_name_1 = if_else(!is.na(sack_player_name) & !is.na(sack_player_name_2),
                                             gsub("^([^,]*,[^,]*),.*$", "\\1", sack_player_name),
                                             NA_character_),
           half_sack_player_name_1 = str_replace(half_sack_player_name_1, "(.*),\\s*(.*)", "\\2 \\1"),
           half_sack_player_name_2 = if_else(!is.na(sack_player_name) & !is.na(sack_player_name_2),
                                                    str_replace(sack_player_name_2, "(.*),\\s*(.*)", "\\2 \\1"),
                                             NA_character_),
           half_sack_player_name_1 = str_squish(half_sack_player_name_1),
           half_sack_player_name_2 = str_squish(half_sack_player_name_2),
           interception_thrown_player_name = if_else(interception == 1,passer_player_name,NA_character_),
           interception_player_name = if_else(interception == 1,
                                              sub(".* by *(.*?) * at .*", "\\1", value),
                                              NA_character_),
           interception_player_name = str_replace(interception_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
           interception_player_name = str_squish(interception_player_name),
           pass_breakup_player_name = if_else(pass_breakup == 1 & str_detect(value, regex("penalty",ignore_case = TRUE)),
                                              str_remove(value,"(?i)penalty.*"),
                                              value),
           pass_breakup_player_name = if_else(pass_breakup == 1,
                                              str_extract(pass_breakup_player_name, "(?<=broken up by ).*"),
                                              NA_character_),
           pass_breakup_player_name = str_remove(pass_breakup_player_name, "[.]"),
           pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, regex(" turnover on downs",ignore_case = TRUE)),
                                              str_remove(pass_breakup_player_name,regex(" turnover on downs",ignore_case = TRUE)),
                                              pass_breakup_player_name),
           pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, regex("challenging",ignore_case = TRUE)),
                                              str_remove(pass_breakup_player_name, "[A-Z]+ is challenging.*"),
                                              pass_breakup_player_name),
           pass_breakup_player_name = str_trim(pass_breakup_player_name, side = "both"),
           pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, regex("QB hurried",ignore_case = TRUE)),
                                          str_remove(pass_breakup_player_name, regex("QB hurried.*",ignore_case = TRUE)),
                                          pass_breakup_player_name),
           pass_breakup_player_name = str_replace(pass_breakup_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
           pass_breakup_player_name = str_squish(pass_breakup_player_name),
           pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, "[,]"),
                                              str_replace(pass_breakup_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                              pass_breakup_player_name),
        #   pass_breakup_player_name = if_else(incompletion == 1 & sack == 0 & is.na(pass_breakup_player_name),
         #                                     str_remove(value,"(?i)penalty.*"),
           #                                   pass_breakup_player_name),
           pass_breakup_player_name = if_else(!is.na(pass_breakup_player_name) & 
                                                str_detect(pass_breakup_player_name, "[()]"),
                                              str_extract(pass_breakup_player_name, "(?<=\\().*(?=\\))"),
                                              pass_breakup_player_name),
           pass_breakup_player_name = if_else(str_count(pass_breakup_player_name, '\\w+') > 4,
                                            NA_character_,pass_breakup_player_name),
           pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, "[0-9]+:[0-9]+"),
                                              NA_character_,pass_breakup_player_name),
           pass_breakup_player_name = if_else(interception == 1,
                                              str_extract(value, "(?<=broken up by ).*"),
                                              pass_breakup_player_name),
           pass_breakup_player_name = if_else(pass_breakup == 1 & is.na(pass_breakup_player_name),
                                              str_extract(value, "(?<=broken up by ).*"),
                                              pass_breakup_player_name),
           pass_breakup_player_name = if_else(interception == 1,
                                              sub(" .*", "", pass_breakup_player_name),
                                              pass_breakup_player_name),
           pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, regex("1st Down",ignore_case = TRUE)),
                                              str_remove(pass_breakup_player_name, "1ST DOWN.*"),
                                              pass_breakup_player_name),
           pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, "[,]"),
                                              str_replace(pass_breakup_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                              pass_breakup_player_name),
       pass_breakup_player_name = if_else(str_detect(pass_breakup_player_name, "[,]"),
                                          str_replace(pass_breakup_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                          pass_breakup_player_name),
           pass_breakup_player_name = str_squish(pass_breakup_player_name),
           qb_hurry_player_name = if_else(qb_hurry == 1,
                                              str_extract(value, "(?<=hurried by ).*"),
                                              NA_character_),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name,regex(", 1ST DOWN.", ignore_case = TRUE)),
                                          str_remove(qb_hurry_player_name, regex(", 1ST DOWN", ignore_case = TRUE)),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name,regex("1ST DOWN.", ignore_case = TRUE)),
                                          str_remove(qb_hurry_player_name, regex("1ST DOWN", ignore_case = TRUE)),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name,regex("End Of Play", ignore_case = TRUE)),
                                          str_remove(qb_hurry_player_name, regex("End Of Play", ignore_case = TRUE)),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name,regex("out of bounds", ignore_case = TRUE)),
                                          str_remove(qb_hurry_player_name, regex("out of bounds", ignore_case = TRUE)),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(value,regex("no play",ignore_case = TRUE)),
                                     NA_character_,
                                     qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, "[.]") & !str_detect(qb_hurry_player_name,"Jr"),
             str_remove(qb_hurry_player_name, "[.].*"),
             qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, regex(", turnover on downs",ignore_case = TRUE)),
           str_remove(qb_hurry_player_name,regex(", turnover on downs",ignore_case = TRUE)),qb_hurry_player_name),
           
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, " \\s*\\([^\\)]+\\)"),
                                          str_remove(qb_hurry_player_name, " \\s*\\([^\\)]+\\)"),
                                                     qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, regex("penalty",ignore_case = TRUE)),
                                          str_remove(qb_hurry_player_name, "(?i)penalty.*"),
                                          qb_hurry_player_name),
           qb_hurry_player_name_2 = if_else(str_detect(qb_hurry_player_name, regex(" and ",ignore_case = TRUE)),
                                            str_extract(qb_hurry_player_name, "(?i)and.*"),
                                            NA_character_),
           qb_hurry_player_name_2 = if_else(str_detect(qb_hurry_player_name_2, regex("and",ignore_case = TRUE)),
                                            str_remove(qb_hurry_player_name_2, "and"),
                                            qb_hurry_player_name_2),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, regex("and",ignore_case = TRUE)),
                                        str_remove(qb_hurry_player_name, " (?i)and.*"),
                                        qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, regex("touchdown",ignore_case = TRUE)),
                                          str_remove(qb_hurry_player_name, regex("touchdown.*",ignore_case = TRUE)),
                                          qb_hurry_player_name), 
           qb_hurry_player_name = if_else(qb_hurry == 1 & is.na(qb_hurry_player_name),
                                     str_extract(value, "(?<=hurry by ).*"),                   
                                     qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, "[.]"),
                                          str_remove(qb_hurry_player_name, "[.]"),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, "at [A-Z]+[0-9]+"),
                                          str_remove(qb_hurry_player_name, "at [A-Z]+[0-9]+"),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, ","),
             str_replace(qb_hurry_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
             qb_hurry_player_name),
           qb_hurry_player_name_2 = if_else(str_detect(qb_hurry_player_name_2, ","),
             str_replace(qb_hurry_player_name_2, "(.*),\\s*(.*)", "\\2 \\1"),
             qb_hurry_player_name_2),
           qb_hurry_player_name = str_squish(qb_hurry_player_name),
           qb_hurry_player_name_2 = str_squish(qb_hurry_player_name_2),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, ","),
                                          str_replace(qb_hurry_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(interception == 1 & qb_hurry == 1,
                                          str_extract(value, "(?<=hurried by ).*"),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(interception == 1 & qb_hurry == 1,
                                          str_extract(qb_hurry_player_name, "^\\S* "),
                                          qb_hurry_player_name),
           qb_hurry_player_name = if_else(str_detect(qb_hurry_player_name, "[,]"),
                                          str_replace(qb_hurry_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                          qb_hurry_player_name),
           qb_hurry_player_name = str_squish(qb_hurry_player_name),
           qb_hurry_player_name_2 = str_squish(qb_hurry_player_name_2),
           tackle_player_name = if_else(punt_return == 1 | kickoff_return == 1|
                                          pass == 1 & sack == 0 & incompletion == 0 | rush == 1 ,
                                        str_remove(value, "(?i)penalty.*"),
                                        NA_character_),
           tackle_player_name = if_else(str_detect(tackle_player_name, ".*\\((\\d+)\\).*"),
                                        str_remove(tackle_player_name, ".*\\((\\d+)\\).*"),
                                        tackle_player_name),
           tackle_player_name = str_remove(tackle_player_name, "^\\S* "),
           tackle_player_name = if_else(!is.na(tackle_player_name),
                                    str_extract(tackle_player_name, "(?<=\\().+?(?=\\))"),NA_character_),
           tackle_player_name = if_else(str_detect(tackle_player_name, "3a"),
                                        str_replace(tackle_player_name, "3a", ";"), 
                                        tackle_player_name),
           tackle_player_name_2 = if_else(str_detect(tackle_player_name, "[;]"),
                                        str_extract(tackle_player_name, "(?<=;).*"),
                                        NA_character_),
           tackle_player_name = if_else(!is.na(tackle_player_name_2),
           str_extract(tackle_player_name, ".*(?=;)"),tackle_player_name),
           tackle_player_name = if_else(str_detect(tackle_player_name, ", Jr."),
                                        str_remove(tackle_player_name, "[,]"),
                                        tackle_player_name),
           tackle_player_name = if_else(str_detect(tackle_player_name, "[,]"),
             str_replace(tackle_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
             tackle_player_name),
           tackle_player_name_2 = if_else(str_detect(tackle_player_name_2, "[,]"),
             str_replace(tackle_player_name_2, "(.*),\\s*(.*)", "\\2 \\1"),
             tackle_player_name_2),
           tackle_player_name = str_squish(tackle_player_name),
           tackle_player_name_2 = str_squish(tackle_player_name_2),
           solo_tackle_player_name = if_else(!is.na(tackle_player_name) & is.na(tackle_player_name_2),
                                             tackle_player_name,NA_character_),
           assissted_tackle_player_name = if_else(!is.na(tackle_player_name) & !is.na(tackle_player_name_2),
                                                  tackle_player_name,NA_character_),
           assissted_tackle_player_name_2 = if_else(!is.na(tackle_player_name) & !is.na(tackle_player_name_2),
                                                  tackle_player_name_2,NA_character_),
           fumble_player_name = if_else(fumble == 1,
                                        sub(".* fumbled by *(.*?) * at .*", "\\1", value),
                                        NA_character_),
      fumble_player_name = if_else(fumble == 1 & is.na(fumble_player_name),
                                   sub(".* fumble by *(.*?) * recovered.*", "\\1", value),
                                   fumble_player_name),
           fumble_player_name = if_else(fumble == 1 & is.na(fumble_player_name),
                                        sub(".* fumble by *(.*?) * recovered.*", "\\1", value),
                                        fumble_player_name),
        fumble_player_name = if_else(fumble == 1 & is.na(fumble_player_name),
                                     sub(".* fumble by *(.*?) * recovered.*", "\\1", value),
                                     fumble_player_name),
           fumble_player_name = if_else(fumble == 1 & sack == 1,
                                        sub(".* fumble by *(.*?) * recovered.*", "\\1", value),
                                        fumble_player_name),
           fumble_player_name = if_else(fumble == 1 & is.na(fumble_player_name),
                                        sub(".* fumbled by *(.*?) * at .*", "\\1", value),
                                        fumble_player_name),
           fumble_player_name = if_else(fumble == 1 & str_detect(fumble_player_name,"[,]"),
                                        str_replace(fumble_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                        fumble_player_name),
           fumble_player_name = str_squish(fumble_player_name),
           fumble_recovered_player_name = if_else(fumble == 1,
                                                  sub(".* recovered by *(.*?) * at .*", "\\1", value),
                                                  NA_character_),
           fumble_recovered_player_name = if_else(str_detect(value,regex("recovered",ignore_case =TRUE)),
                                                  fumble_recovered_player_name,
                                                  NA_character_),
           fumble_recovered_team = if_else(!is.na(fumble_recovered_player_name),
                                           str_extract(fumble_recovered_player_name, "[A-Z]+"),
                                           NA_character_),
           fumble_recovered_team = str_trim(fumble_recovered_team, side = "both"),
           fumble_recovered_player_name = if_else(str_count(fumble_recovered_player_name,'\\w+') > 6,
                                                  NA_character_,
                                                  fumble_recovered_player_name),
           fumble_recovered_player_name = if_else(str_detect(fumble_recovered_player_name, "[A-Z]+"),
                                                  str_remove(fumble_recovered_player_name,"[A-Z]+"),
                                                  fumble_recovered_player_name),
           fumble_recovered_player_name = if_else(!is.na(fumble_recovered_player_name),
                                                  str_replace(fumble_recovered_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                                  fumble_recovered_player_name),
           fumble_recovered_team = if_else(fumble == 1 & is.na(fumble_recovered_player_name),
                                           sub(".* recovered by *(.*?) * at,.*", "\\1", value),
                                           fumble_recovered_team),
        fumble_recovered_team = if_else(str_count(fumble_recovered_team,'\\w+') > 6,
                                                  NA_character_,
                                                  fumble_recovered_team),
        fumble_recovered_player_name = if_else(str_detect(fumble_recovered_player_name,"igers"),
                                               str_remove(fumble_recovered_player_name,"igers"),
                                               fumble_recovered_player_name),
           fumble_recovered_player_name = str_squish(fumble_recovered_player_name),
           fumble_recovered_team = str_trim(fumble_recovered_team, side = "both"),
           timeout_team = if_else(timeout == 1,
                                  sub(".*(?i)Timeout *(.*?) *clock.*", "\\1", value),
                                  NA_character_),
           timeout_team = if_else(timeout == 1,
                                  str_remove(timeout_team, "[,]"),
                                  timeout_team),
        timeout_team = if_else(str_detect(timeout_team, "(?<=\\().*(?=\\))"),
        sub(" .*", "", timeout_team),
        timeout_team),
           timeout_team = str_trim(timeout_team, side = "both"),
        punt_block_player_name = if_else(punt_blocked == 1,
                                            str_extract(value, "by\\s*(.*?)\\s*recovered"),
                                            NA_character_),
           punt_block_player_name = if_else(str_detect(punt_block_player_name, "[\\(blocked)]"),
                                            str_extract(punt_block_player_name, "(?<=\\().*(?=\\))"),
                                            punt_block_player_name),
           punt_block_player_name = if_else(str_detect(punt_block_player_name, "blocked by"),
                                            str_remove(punt_block_player_name, "blocked by"),
                                            punt_block_player_name),
        punt_block_player_name = if_else(punt_blocked == 1 & is.na(punt_block_player_name),
                                         str_extract(value, "by\\s*(.*?)\\s*recovered"),
                                         punt_block_player_name),
        punt_block_player_name = if_else(str_detect(punt_block_player_name, "[,]"),
             str_replace(punt_block_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
             punt_block_player_name),
        punt_block_player_name = if_else(str_detect(punt_block_player_name, "recovered by"),
                                         str_remove(punt_block_player_name, "recovered by"),
                                         punt_block_player_name),
        punt_block_player_name = if_else(punt_blocked == 1 & is.na(punt_block_player_name) & 
                                           str_detect(value, regex("turnover on downs.",ignore_case = TRUE)),
                                         value,
                                         punt_block_player_name),
        punt_block_player_name = if_else(punt_blocked == 1 & 
                                           str_detect(punt_block_player_name, regex(", turnover on downs.",ignore_case = TRUE)),
                                         str_remove(punt_block_player_name, regex(", turnover on downs.", ignore_case = TRUE)),
                                         punt_block_player_name),
        punt_block_player_name = if_else(punt_blocked == 1 & str_detect(punt_block_player_name,regex("blocked",ignore_case = TRUE)),
                                         str_remove(punt_block_player_name, ".*blocked by"),
                                         punt_block_player_name),
        punt_block_player_name = if_else(punt_blocked == 1 & str_detect(punt_block_player_name, regex("downs",ignore_case = TRUE)),
                                         str_remove(value, regex(", turnover on downs.",ignore_case = TRUE)),
                                         punt_block_player_name),
        punt_block_player_name = if_else(str_detect(punt_block_player_name, "[,]"),
                                         str_replace(punt_block_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
                                         punt_block_player_name),
         punt_block_player_name = str_squish(punt_block_player_name),
           punt_block_recovered_player_name = if_else(punt_blocked == 1 & str_detect(value,regex("recovered",ignore_case = TRUE)),
                                            sub(".* recovered by *(.*?) *at.*", "\\1", value),
                                            NA_character_),
           punt_block_recovered_team = str_extract(punt_block_recovered_player_name, "[A-Z]+"),
           punt_block_recovered_team = str_trim(punt_block_recovered_team, side = "both"),
           punt_block_recovered_player_name = str_remove(punt_block_recovered_player_name, "[A-Z]+"),
           punt_block_recovered_player_name = str_replace(punt_block_recovered_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
           punt_block_player_name = str_squish(punt_block_player_name),
           punt_block_recovered_player_name = str_squish(punt_block_recovered_player_name),
           field_goal_block_player_name = if_else(field_goal_blocked == 1,
                                                    sub(".* blocked by *(.*?)", "\\1", value),
                                                    NA_character_),
           field_goal_block_player_name = str_trim(field_goal_block_player_name),
           field_goal_block_player_name = if_else(field_goal_blocked == 1,
                                                  sub(" .*", "", field_goal_block_player_name),
                                                  NA_character_),
           field_goal_block_player_name = str_replace(field_goal_block_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
           field_goal_block_player_name = str_squish(field_goal_block_player_name),
           field_goal_block_recovered_player_name = if_else(field_goal_blocked == 1,
                                                      sub(".* recovered by *(.*?) *at.*", "\\1", value),
                                                      NA_character_),
           field_goal_block_recovered_team = str_extract(field_goal_block_recovered_player_name, "[A-Z]+"),
           field_goal_block_recovered_team = str_trim(field_goal_block_recovered_team, side = "both"),
           field_goal_block_recovered_player_name = str_remove(field_goal_block_recovered_player_name, "[A-Z]+"),
           field_goal_block_recovered_player_name = str_replace(field_goal_block_recovered_player_name, "(.*),\\s*(.*)", "\\2 \\1"),
           field_goal_block_recovered_player_name = str_squish(field_goal_block_recovered_player_name),
           field_goal_block_recovered_player_name = str_squish(field_goal_block_recovered_player_name),
           field_goal_returner_player_name = NA_character_,
           touchdown_player_name = if_else(passing_touchdown == 1,reception_player_name,NA_character_),
           touchdown_player_name = if_else(rushing_touchdown == 1,rusher_player_name,touchdown_player_name),
           touchdown_player_name = if_else(punt_return_td == 1,punt_returner_player_name,touchdown_player_name),
           touchdown_player_name = if_else(kickoff_return_td == 1,kickoff_returner_player_name,touchdown_player_name),
           touchdown_player_name = if_else(interception_return_touchdown == 1, interception_player_name, touchdown_player_name),
           touchdown_player_name = if_else(fumble_return_touchdown == 1, fumble_recovered_player_name,touchdown_player_name),
           touchdown_player_name = if_else(field_goal_return_touchdown == 1, field_goal_returner_player_name, touchdown_player_name),
           touchdown_player_name = if_else(punt_blocked == 1 & touchdown_play == 1,punt_block_recovered_player_name,touchdown_player_name)
           )
  
                                                    
                                                    
           
          
                                        
          
           
           
  
  
  
  
  
}


test_names <- name_function_lastname_firstname_semicolon_parenthesis(valdosta_game_wk6)  |> 
  filter(kickoff_play == 1) |> 
  select(value,kickoff_player_name,kickoff_returner_player_name)
view(test_names)
